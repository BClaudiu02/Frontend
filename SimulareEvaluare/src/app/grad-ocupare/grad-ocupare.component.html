<div class="grad-ocupare-container">
  <div class="header" style="display: flex; justify-content: space-between; align-items: center;">
    <button class="back-button" (click)="goBack()">{{ translations[language].back }}</button>
    <button class="lang-switch" (click)="toggleLanguage()" style="margin-left:auto; min-width: 48px; padding: 6px 16px; border-radius: 20px; border: 1px solid #007bff; background: #f8f9fa; color: #007bff; font-weight: bold; cursor: pointer;">
      {{ language === 'ro' ? 'EN' : 'RO' }}
    </button>
  </div>

  <h1>{{ translations[language].title }}</h1>

  <div class="input-section">
    <label for="userPosition">{{ translations[language].inputLabel }}</label>
    <input type="number" id="userPosition" [(ngModel)]="userPosition" placeholder="500" min="1" />
    <button (click)="analyzeOccupancy()" [disabled]="!userPosition || isLoading">
      {{ translations[language].analyze }}
    </button>
  </div>

  <div *ngIf="analyzed && userGrade" class="user-info">
    <p>
      <strong>{{ translations[language].position }}</strong> {{ userPosition }} ({{ translations[language].grade }}
      {{ userGrade | number : "1.2-2" }})
    </p>
  </div>

  <div *ngIf="isLoading" class="loading">{{ translations[language].loading }}</div>

  <div *ngIf="analyzed && !isLoading" class="results">
    <div class="section">
      <h2>{{ translations[language].completTitle }}</h2>
      <table *ngIf="completOcupate.length > 0; else noDataComplete">
        <thead>
          <tr>
            <th>{{ translations[language].schoolSpec }}</th>
            <th>{{ translations[language].index }}</th>
            <th>{{ translations[language].occupied }}</th>
            <th>{{ translations[language].free }}</th>
            <th>{{ translations[language].rate }}</th>
            <th>{{ translations[language].lastGrade }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of completOcupate">
            <td class="school-specialization-cell">
              <div class="school-name">{{ item.school }}</div>
              <div class="specialization-name">{{ item.specialization }}</div>
              <div class="language-name">{{ item.language }}</div>
            </td>
            <td>{{ item.indexRange }}</td>
            <td>{{ item.occupiedSlots }}</td>
            <td>{{ item.freeSlots }}</td>
            <td>{{ item.occupancyRate | number : "1.2-2" }}%</td>
            <td>{{ item.lastAdmittedGrade | number : "1.2-2" }}</td>
          </tr>
        </tbody>
      </table>
      <ng-template #noDataComplete>
        <p>{{ translations[language].noDataComplete }}</p>
      </ng-template>
    </div>

    <div class="section">
      <h2>{{ translations[language].partialTitle }}</h2>
      <table *ngIf="partialOcupate.length > 0; else noDataPartial">
        <thead>
          <tr>
            <th>{{ translations[language].schoolSpec }}</th>
            <th>{{ translations[language].index }}</th>
            <th>{{ translations[language].occupied }}</th>
            <th>{{ translations[language].free }}</th>
            <th>{{ translations[language].rate }}</th>
            <th>{{ translations[language].lastGrade }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of partialOcupate">
            <td class="school-specialization-cell">
              <div class="school-name">{{ item.school }}</div>
              <div class="specialization-name">{{ item.specialization }}</div>
              <div class="language-name">{{ item.language }}</div>
            </td>
            <td>{{ item.indexRange }}</td>
            <td>{{ item.occupiedSlots }}</td>
            <td>{{ item.freeSlots }}</td>
            <td>{{ item.occupancyRate | number : "1.2-2" }}%</td>
            <td>{{ item.lastAdmittedGrade | number : "1.2-2" }}</td>
          </tr>
        </tbody>
      </table>
      <ng-template #noDataPartial>
        <p>{{ translations[language].noDataPartial }}</p>
      </ng-template>
    </div>

    <div class="section">
      <h2>{{ language === 'ro' ? 'Specializari fara locuri ocupate' : 'Specializations with no occupied slots' }}</h2>
      <table *ngIf="neocupate.length > 0; else noDataEmpty">
        <thead>
          <tr>
            <th>{{ translations[language].schoolSpec }}</th>
            <th>{{ translations[language].index }}</th>
            <th>{{ translations[language].occupied }}</th>
            <th>{{ translations[language].free }}</th>
            <th>{{ translations[language].rate }}</th>
            <th>{{ translations[language].lastGrade }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of neocupate">
            <td class="school-specialization-cell">
              <div class="school-name">{{ item.school }}</div>
              <div class="specialization-name">{{ item.specialization }}</div>
              <div class="language-name">{{ item.language }}</div>
            </td>
            <td>{{ item.indexRange }}</td>
            <td>{{ item.occupiedSlots }}</td>
            <td>{{ item.freeSlots }}</td>
            <td>{{ item.occupancyRate | number : "1.2-2" }}%</td>
            <td>{{ item.lastAdmittedGrade | number : "1.2-2" }}</td>
          </tr>
        </tbody>
      </table>
      <ng-template #noDataEmpty>
        <p>
          {{ language === 'ro' ? 'Nu exista specializari cu locuri disponibile pentru aceasta pozitie.' : 'No specializations with available slots for this position.' }}
        </p>
      </ng-template>
    </div>
  </div>
</div>